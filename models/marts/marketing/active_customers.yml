version: 2

models:
  - name: active_customers
    description: >
      Active customers with their order statistics. 
    data_tests:
      - dbt_utils.expression_is_true:
          arguments:
            expression: "orders_ordered + orders_pending + orders_cancelled + orders_delivered = orders_total"
          config:
            severity: error

    columns:
      - name: customer_id
        description: Unique identifier for the customer. Primary key.
        data_tests:
          - unique
          - not_null

      - name: first_name
        description: Customer's first name
        data_tests:
          - not_null

      - name: last_name
        description: Customer's last name
        data_tests:
          - not_null

      - name: orders_ordered
        description: Total number of orders with the status "ordered"
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0

      - name: orders_pending
        description: Total number of orders with the status "pending"
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0

      - name: orders_cancelled
        description: Total number of orders with the status "cancelled"
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0

      - name: orders_delivered
        description: Total number of orders with the status "delivered"
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0

      - name: orders_total
        description: Total number of orders altogether
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0